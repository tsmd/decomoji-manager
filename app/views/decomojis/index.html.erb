<h2 class="mt-12 mb-4">デコモジ</h2>

<div class="mt-4">
  <p><%= link_to 'デコモジを追加する', new_decomoji_path %></p>
  <p><%= link_to 'デコモジをまとめて追加する', new_batch_path %></p>
</div>

<div class="h-4"></div>

<form action="<%= root_path %>">
  <p>
    <label for="search">検索</label>
    <input type="text" name="search" value="<%= params[:search] %>" id="search">
    <input type="submit" value="検索">
  </p>
</form>

<div class="h-4"></div>

<% if @decomojis.empty? %>
  <p>条件に合うデコモジがありません</p>
<% else %>
  <p>
    他フォーマット：
    <%= link_to 'JSON', decomojis_path(format: :json, search: params[:search]) %>
    <%= link_to 'CSV', decomojis_path(format: :csv, search: params[:search]) %>
    <%= link_to 'TSV', decomojis_path(format: :tsv, search: params[:search]) %>
  </p>

  <div class="mt-4">
    <p>
      <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
    </p>
    <p class="mt-4">
      <%= pagy_info_with_comma(@pagy) %>
    </p>
  </div>

  <div class="h-4"></div>

  <%= form_with method: :get,  class: 'group/decomojis', data: {
    controller: 'enhanced-checkbox',
    action: 'click->enhanced-checkbox#memoShiftKey change->enhanced-checkbox#handleCheck',
  } do %>
    <div class="fixed top-0 inset-x-0 bottom-auto z-10 hidden flex-wrap items-baseline gap-2 border-b border-black bg-white p-2 group-has-[:checked]/decomojis:flex">
      選択したものを
      <button
        type="submit"
        formaction="<%= new_bulk_add_tag_path %>"
        data-turbo-frame="new-bulk-add-tag"
        data-controller="invoker"
        data-invoker-target-value="bulk-add-tag"
        data-action="click->invoker#invoke"
      >
        まとめてタグ付け
      </button>
      <button type="submit" formaction="<%= new_check_path %>">
        チェックを作成
      </button>
      <button type="reset">選択解除</button>

      <dialog id="bulk-add-tag" class="relative p-8" data-controller="dialog" data-action="invoker:invoke->dialog#showModal">
        <button class="mb-4" type="button" data-action="dialog#close">閉じる</button>
        <turbo-frame id="new-bulk-add-tag" loading="lazy"></turbo-frame>
      </dialog>
    </div>
    <ul class="decomojis grid grid-cols-[repeat(auto-fill,minmax(80px,1fr))] gap-4">
      <% @decomojis.each do |decomoji| %>
      <li class="decomoji group/decomoji relative z-0 aspect-square border-2 border-transparent bg-[color-mix(in_srgb,var(--decomoji-color),#fff_95%)] bg-origin-border select-none" style="--decomoji-color: <%= decomoji.color&.hex || '#000' %>">
        <label class="absolute top-0 left-0 p-1 group-has-[:checked]/decomojis:inset-0">
          <input
            class="block opacity-0 accent-[--decomoji-color] focus:opacity-100 group-has-[:checked]/decomojis:opacity-100 group-hover/decomoji:opacity-100"
            type="checkbox"
            name="ids[]"
            value="<%= decomoji.id %>"
            aria-labelledby="decomoji-<%= decomoji.id %>"
            data-enhanced-checkbox-target="checkbox"
          >
        </label>
        <%= link_to decomoji, class: 'block p-2' do %>
          <%= render 'decomoji_figure', decomoji: decomoji %>
        <% end %>
      </li>
      <% end %>
    </ul>
  <% end %>

  <div class="h-4"></div>

  <div>
    <p>
      <%= pagy_info_with_comma(@pagy) %>
    </p>
    <p class="mt-4">
      <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
    </p>
  </div>
<% end %>
